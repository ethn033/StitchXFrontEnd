<div class="d-flex justify-content-between align-items-center mb-5">
    <div>
      <h2 class="">Customers Overview</h2>    
    </div>
    <button pButton label="New Customer" (click)="showNewCustomerDialog()" icon="pi pi-plus" class="btn btn-primary"></button>
</div>


<p-table [value]="customers" [paginator]="true" [rows]="10" [rowsPerPageOptions]="[10,25,50]" [loading]="loading" stripedRows size="small">
<ng-template pTemplate="header">
  <tr>
    <th pSortableColumn="firstName">Customer <p-sortIcon field="firstName"></p-sortIcon></th>
    <th>Contact</th>
    <th>Orders</th>
    <th>Status</th>
    <th>Outstanding</th>
    <th style="width: 120px">Actions</th>
  </tr>
</ng-template>

<ng-template pTemplate="body" let-customer>
  <tr>
    <td>
      <div class="customer-name">
        <span class="font-medium">{{ customer.firstName }} {{ customer.lastName }}</span>
        <small class="block text-color-secondary">{{ customer.address | truncate:30 }}</small>
      </div>
    </td>
    <td>
      <div class="customer-contact">
        <div *ngIf="customer.phone" class="flex align-items-center mb-1">
          <i class="pi pi-phone mr-2"></i>
          <span>{{ customer.phone }}</span>
        </div>
        <div *ngIf="customer.email" class="flex align-items-center">
          <i class="pi pi-envelope mr-2"></i>
          <span>{{ customer.email | truncate:20 }}</span>
        </div>
      </div>
    </td>
    <td>
      <span class="font-medium">{{ customer.totalOrders || 0 }}</span>
      <small class="block text-color-secondary">total</small>
    </td>
    <td>
      <p-tag  [severity]="customer.pendingOrders ? 'warn' : 'success'" 
        [value]="customer.pendingOrders ? 'Pending' : 'Clear'"
      ></p-tag>
      <small *ngIf="customer.pendingOrders" class="block text-color-secondary">
        {{ customer.pendingOrders }} items
      </small>
    </td>
    <td>
      <span class="font-medium" [ngClass]="{'text-red-500': customer.outstandingAmount > 0}">
        {{ customer.outstandingAmount | currency:'INR' }}
      </span>
      <small *ngIf="customer.outstandingAmount > 0" class="block text-color-secondary">
        Due {{ customer.lastOrderDate | date:'shortDate' }}
      </small>
    </td>
    <td>
      <div class="flex flex-wrap gap-1">
        <button 
          pButton 
          icon="pi pi-eye" 
          class="p-button-sm p-button-rounded p-button-text"
          pTooltip="View" 
          tooltipPosition="top"
          (click)="viewCustomer(customer)"
        ></button>
        <button 
          pButton 
          icon="pi pi-pencil" 
          class="p-button-sm p-button-rounded p-button-text"
          pTooltip="Edit" 
          tooltipPosition="top"
          (click)="editCustomer(customer)"
        ></button>
        <button 
          pButton 
          icon="pi pi-shopping-cart" 
          class="p-button-sm p-button-rounded p-button-text"
          pTooltip="Take Order" 
          tooltipPosition="top"
          (click)="takeOrder(customer)"
        ></button>
        <button 
          pButton 
          icon="pi pi-trash" 
          class="p-button-sm p-button-rounded p-button-text p-button-danger"
          pTooltip="Delete" 
          tooltipPosition="top"
          (click)="confirmDelete(customer)"
        ></button>
      </div>
    </td>
  </tr>
</ng-template>

<ng-template pTemplate="emptymessage">
  <tr>
    <td colspan="6" class="text-center py-5">
      <div *ngIf="!loading" class="flex flex-column align-items-center">
        <i class="pi pi-users text-4xl text-400 mb-3"></i>
        <h4 class="text-900 mb-1">No Customers Found</h4>
        <p class="text-600">Add your first customer to get started</p>
        <button 
          pButton 
          label="Add Customer" 
          icon="pi pi-plus" 
          class="p-button-outlined mt-3"
          (click)="showNewCustomerDialog()"
        ></button>
      </div>
    </td>
  </tr>
</ng-template>
</p-table>

<p-confirmDialog 
[style]="{width: '450px'}" 
header="Confirm Deletion" 
icon="pi pi-exclamation-triangle"
></p-confirmDialog>